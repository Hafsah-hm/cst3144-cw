<html>
  <head>
    <title>After School Activities</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" rel="stylesheet">
    <script src="activities.js"></script>
    <link rel="stylesheet" href="styles.css">
  </head>

  <body>
    <div id="app">
      <header>
        <h1 v-text="sitename"></h1>
        <button v-on:click="showCheckout">
          {{ cartItemCount }}
          <i class="fa-solid fa-cart-plus"></i>
          Checkout
        </button>
      </header>

      <!-- Filters (under the header) -->
      <section class="filters">
        <!-- Price buttons -->
        <div>
          <strong>Price:</strong>
          <button class="btn-outline" @click="priceFilter='all'">Show All</button>
          <button class="btn-outline" @click="priceFilter='le70'">≤70</button>
          <button class="btn-outline" @click="priceFilter='71_80'">71–80</button>
          <button class="btn-outline" @click="priceFilter='81_90'">81–90</button>
          <button class="btn-outline" @click="priceFilter='91_100'">91–100</button>
          <button class="btn-outline" @click="priceFilter='gt100'">100+</button>
        </div>

        <!-- In-stock only -->
        <div>
          <label>
            <input type="checkbox" v-model="filters.inStockOnly">
            In stock only
          </label>
        </div>

        <!-- Sort radios -->
        <div>
          <strong>Sort:</strong>
          <label><input type="radio" value="az" v-model="filters.sortAlpha"> Ascending</label>
          <label><input type="radio" value="za" v-model="filters.sortAlpha"> Descending</label>
        </div>

        <div>
          <button class="btn-reset" @click="resetFilters">Reset</button>
        </div>
      </section>

      <main>
        <!-- Product List -->
        <div v-if="showProduct">
          <!-- Cards (sort first, filter with v-if inside each card) -->
          <div v-for="product in sortedByTitle" :key="product.id"
               class="card"
               v-if="(priceFilter==='all'
                       || (priceFilter==='le70' && product.price<=70)
                       || (priceFilter==='71_80' && product.price>=71 && product.price<=80)
                       || (priceFilter==='81_90' && product.price>=81 && product.price<=90)
                       || (priceFilter==='91_100' && product.price>=91 && product.price<=100)
                       || (priceFilter==='gt100' && product.price>=101))
                     && (!filters.inStockOnly
                         || (product.availableInventory - cartCount(product.id) > 0))">

            <figure><img :src="product.image" alt=""></figure>
            <h2 v-text="product.title"></h2>
            <p v-text="product.description"></p>

            <p class="price">Price: £{{ product.price }}</p>
            <p>Location: {{ product.Location }}</p>
            <p>space: {{ product.availableInventory - cartCount(product.id) }}</p>

            <!-- Purchase controls: ONLY Add to cart or Out of Stock -->
            <div class="controls">
              <button
                v-if="canAddToCart(product)"
                class="btn-primary"
                @click="addToCart(product)"
              >
                Add to cart
              </button>
              <button v-else class="btn-outline" disabled>Out of Stock</button>
            </div>

            <div class="stock">
              <span v-if="product.availableInventory === cartCount(product.id)">All out!</span>
              <span v-else-if="product.availableInventory - cartCount(product.id) < 5">
                Only {{ product.availableInventory - cartCount(product.id) }} left!
              </span>
              <span v-else>Buy now!</span>
            </div>
          </div>

          <!-- Simple message if nothing visible -->
          <p v-if="visibleCount === 0">No activities match your filter.</p>
        </div>

        <!-- Checkout -->
        <div v-else>
          <h2>Checkout</h2>

          <!-- Cart Summary -->
          <section>
            <h3>Your Cart</h3>

            <div v-if="cartDetails.length" class="cart-list">
              <div v-for="item in cartDetails" :key="item.id" class="cart-row">
                <img :src="item.image" alt="">
                <div class="cart-info">
                  <p class="title">{{ item.title }}</p>
                  <p class="sub">
                    £{{ item.price.toFixed ? item.price.toFixed(2) : item.price }}
                    • Qty: {{ item.qty }}
                    • Location: {{ item.location }}
                    • Total: £{{ (item.price * item.qty).toFixed(2) }}
                  </p>
                </div>
                <!-- No +/- or remove controls in checkout -->
              </div>

              <p class="total">Cart Total: £{{ cartTotal }}</p>
            </div>

            <p v-else>Your cart is empty.</p>
          </section>

          <!-- Customer Details -->
          <div class="checkout-block">
            <p><strong>First Name: </strong><input v-model="order.firstName" /></p>
            <p><strong>Last Name: </strong><input v-model="order.lastName" /></p>
            <p><strong>Address: </strong><input v-model="order.address" /></p>
            <p><strong>City: </strong><input v-model="order.city" /></p>
            <p>
              <strong>State: </strong>
              <select v-model="order.state">
                <option disabled value="">State</option>
                <option v-for="(state, key) in states" :value="state" :key="key">{{ key }}</option>
              </select>
            </p>
            <p><strong>Zip Postal Code: </strong><input v-model="order.zip" /></p>

            <p>
              <input type="checkbox" id="gift" value="true" v-model="order.gift"
                     :true-value="order.sendGift" :false-value="order.dontSendGift">
              <label for="gift">Ship As Gift?</label>
            </p>

            <p><input type="radio" id="home" value="Home" v-model="order.method">
               <label for="home">Home</label></p>
            <p><input type="radio" id="business" value="Business" v-model="order.method">
               <label for="business">Business</label></p>

            <h2>Order Information</h2>
            <p>First Name: {{ order.firstName }}</p>
            <p>Last Name: {{ order.lastName }}</p>
            <p>Address: {{ order.address }}</p>
            <p>City: {{ order.city }}</p>
            <p>Zip: {{ order.zip }}</p>
            <p>State: {{ order.state }}</p>
            <p>Gift: {{ order.gift }}</p>
            <p>Method: {{ order.method }}</p>

            <button class="btn-primary" v-on:click="submitForm">Place Order</button>
          </div>
        </div>
      </main>
    </div>

    <script type="text/javascript">
      let webstore = new Vue({
        el: '#app',
        data: {
          sitename: 'Vue.js Pet Depot',
          activities: activities,   // from activities.js
          cart: [],                 // stores product IDs
          showProduct: true,

          // simple filters
          priceFilter: 'all',          // 'all' | 'le70' | '71_80' | '81_90' | '91_100' | 'gt100'
          filters: {
            inStockOnly: false,
            sortAlpha: 'az'            // 'az' or 'za'
          },

          // order template
          orderDefault: {
            firstName: '', lastName: '', address: '', city: '',
            state: '', zip: '', method: 'Home', gift: false,
            sendGift: 'Send as a gift', dontSendGift: 'do not send as a gift'
          },
          order: {
            firstName: '', lastName: '', address: '', city: '',
            state: '', zip: '', method: 'Home', gift: false,
            sendGift: 'Send as a gift', dontSendGift: 'do not send as a gift'
          },

          // simple local states list
          states: { Dxb: 'Dubai', Sjh: 'Sharjah', Aj: 'Ajman', Ala: 'Al ain' }
        },

        methods: {
          // add to cart (allows multiple)
          addToCart(product){
            if (this.canAddToCart(product)) {
              this.cart.push(product.id);
            }
          },

          // checks
          canAddToCart(product){
            return product.availableInventory > this.cartCount(product.id);
          },
          cartCount(id){
            let c = 0;
            for (let i = 0; i < this.cart.length; i++) {
              if (this.cart[i] === id) c++;
            }
            return c;
          },

          // view + submit
          showCheckout(){
            this.showProduct = !this.showProduct;
          },
          submitForm(){
            alert('Order Submitted!');
            this.cart.length = 0;                              // clear cart
            this.order = Object.assign({}, this.orderDefault); // reset form
            this.showProduct = true;                           // go back "home"
          },

          resetFilters(){
            this.priceFilter = 'all';
            this.filters.inStockOnly = false;
            this.filters.sortAlpha = 'az';
          }
        },

        computed: {
          cartItemCount(){
            return this.cart.length || '';
          },

          cartDetails(){
            const list = [];
            for (let i = 0; i < this.activities.length; i++) {
              const p = this.activities[i];
              const qty = this.cartCount(p.id);
              if (qty > 0) {
                list.push({
                  id: p.id,
                  title: p.title,
                  price: p.price,
                  image: p.image,
                  location: p.Location,   // include Location for checkout display
                  qty: qty
                });
              }
            }
            return list;
          },

          cartTotal(){
            const t = this.cartDetails.reduce((s, it) => s + it.price * it.qty, 0);
            return t.toFixed(2);
          },

          // only sorting happens here (A→Z or Z→A)
          sortedByTitle(){
            const copy = this.activities.slice();
            copy.sort((a, b) => {
              const cmp = a.title.localeCompare(b.title);
              return this.filters.sortAlpha === 'az' ? cmp : -cmp;
            });
            return copy;
          },

          // count visible cards (same conditions as v-if) to show "No activities" message
          visibleCount(){
            let n = 0;
            for (let i = 0; i < this.activities.length; i++) {
              const p = this.activities[i];
              const remaining = p.availableInventory - this.cartCount(p.id);
              const matchesStock = (!this.filters.inStockOnly) || (remaining > 0);
              let matchesPrice = false;

              if (this.priceFilter === 'all') matchesPrice = true;
              else if (this.priceFilter === 'le70' && p.price <= 70) matchesPrice = true;
              else if (this.priceFilter === '71_80' && p.price >= 71 && p.price <= 80) matchesPrice = true;
              else if (this.priceFilter === '81_90' && p.price >= 81 && p.price <= 90) matchesPrice = true;
              else if (this.priceFilter === '91_100' && p.price >= 91 && p.price <= 100) matchesPrice = true;
              else if (this.priceFilter === 'gt100' && p.price >= 101) matchesPrice = true;

              if (matchesPrice && matchesStock) n++;
            }
            return n;
          }
        }
      });
    </script>
  </body>
</html>
