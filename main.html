<html>
  <head>
    <title>After School Activities</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" rel="stylesheet">
    <script src="activities.js"></script>
    <link rel="stylesheet" href="styles.css">
  </head>

  <body>
    <div id="app">
      <header>
        <h1 v-text="sitename"></h1>
        
        <button :disabled="cart.length===0" v-on:click="showCheckout">
          {{ cartItemCount }}
          <i class="fa-solid fa-cart-plus"></i>
          Checkout
        </button>
      </header>

      <!-- Filters -->
      <section class="filters">
        <div>
          <label>
            <input type="checkbox" v-model="filters.inStockOnly">
            In stock only
          </label>
        </div>

        <!-- Sort radios -->
        <div>
          <strong>Sort:</strong>
          <label><input type="radio" value="az" v-model="filters.sortAlpha"> Ascending</label>
          <label><input type="radio" value="za" v-model="filters.sortAlpha"> Descending</label>
        </div>

        <div>
          <button class="btn-reset" @click="resetFilters">Reset</button>
        </div>
      </section>

      <main>
        <!-- Product List -->
        <div v-if="showProduct">
          <div
            v-for="product in sortedByTitle"
            :key="product.id"
            class="card"
            v-if="!filters.inStockOnly || (product.availableInventory - cartCount(product.id) > 0)"
          >
            <figure><img :src="product.image" alt=""></figure>
            <h2 v-text="product.title"></h2>
            <p v-text="product.description"></p>

            <p class="price">Price: £{{ product.price }}</p>
            <p>Location: {{ product.Location }}</p>
            <p>Spaces: {{ product.availableInventory - cartCount(product.id) }}</p>

            <div class="controls">
              <button
                v-if="canAddToCart(product)"
                class="btn-primary"
                @click="addToCart(product)"
              >Add to cart</button>
              <button v-else class="btn-outline" disabled>Out of Stock</button>
            </div>

            <div class="stock">
              <span v-if="product.availableInventory === cartCount(product.id)">All out!</span>
              <span v-else-if="product.availableInventory - cartCount(product.id) < 5">
                Only {{ product.availableInventory - cartCount(product.id) }} left!
              </span>
              <span v-else>Buy now!</span>
            </div>
          </div>

          <p v-if="visibleCount === 0">No activities match your filter.</p>
        </div>

        <!-- Checkout -->
        <div v-else>
          <h2>Checkout</h2>

          <!-- Cart Summary -->
          <section>
            <h3>Your Cart</h3>

            <div v-if="cartDetails.length" class="cart-list">
              <div v-for="item in cartDetails" :key="item.id" class="cart-row">
                <img :src="item.image" alt="">
                <div class="cart-info">
                  <p class="title">{{ item.title }}</p>
                  <p class="sub">
                    £{{ item.price }}
                    • Qty: {{ item.qty }}
                    • Location: {{ item.location }}
                    • Total: £{{ (item.price * item.qty).toFixed(2) }}
                  </p>
                </div>

               
                <button class="btn-outline" @click="removeOneById(item.id)">Remove one</button>

              </div>

              <p class="total">Cart Total: £{{ cartTotal }}</p>
            </div>

            <p v-else>Your cart is empty.</p>
          </section>

          <!-- Customer Details -->
          <div class="checkout-block">
            <p><strong>First Name: </strong><input v-model="order.firstName" /></p>
            <p><strong>Last Name: </strong><input v-model="order.lastName" /></p>
            <p><strong>Address: </strong><input v-model="order.address" /></p>
            <p><strong>City: </strong><input v-model="order.city" /></p>
            <p>
              <strong>State: </strong>
              <select v-model="order.state">
                <option disabled value="">State</option>
                <option v-for="(state, key) in states" :value="state" :key="key">{{ key }}</option>
              </select>
            </p>
            <p><strong>Zip Postal Code: </strong><input v-model="order.zip" /></p>

            <p>
              <input type="checkbox" id="gift" value="true" v-model="order.gift"
                     :true-value="order.sendGift" :false-value="order.dontSendGift">
              <label for="gift">Ship As Gift?</label>
            </p>

            <p><input type="radio" id="home" value="Home" v-model="order.method"><label for="home">Home</label></p>
            <p><input type="radio" id="business" value="Business" v-model="order.method"><label for="business">Business</label></p>

            <h2>Order Information</h2>
            <p>First Name: {{ order.firstName }}</p>
            <p>Last Name: {{ order.lastName }}</p>
            <p>Address: {{ order.address }}</p>
            <p>City: {{ order.city }}</p>
            <p>Zip: {{ order.zip }}</p>
            <p>State: {{ order.state }}</p>
            <p>Gift: {{ order.gift }}</p>
            <p>Method: {{ order.method }}</p>

            <button class="btn-primary" v-on:click="submitForm">Place Order</button>
          </div>
        </div>
      </main>
    </div>

    <script>
      let webstore = new Vue({
        el:'#app',
        data:{
          sitename:'Vue.js Pet Depot',
          activities: activities,
          cart:[],
          showProduct:true,
          filters:{ inStockOnly:false, sortAlpha:'az' },
          orderDefault:{ firstName:'',lastName:'',address:'',city:'',state:'',zip:'',method:'Home',gift:false,sendGift:'Send as a gift',dontSendGift:'do not send as a gift' },
          order:{ firstName:'',lastName:'',address:'',city:'',state:'',zip:'',method:'Home',gift:false,sendGift:'Send as a gift',dontSendGift:'do not send as a gift' },
          states:{ Dxb:'Dubai',Sjh:'Sharjah',Aj:'Ajman',Ala:'Al ain' }
        },
        methods:{
          addToCart(p){ if(this.canAddToCart(p)) this.cart.push(p.id); },
          removeOneById(id){
            const i = this.cart.indexOf(id);
            if(i !== -1) this.cart.splice(i,1);
          },
          canAddToCart(p){ return p.availableInventory > this.cartCount(p.id); },
          cartCount(id){ return this.cart.filter(pid=>pid===id).length; },
          showCheckout(){ this.showProduct = !this.showProduct; },
          submitForm(){
            alert('Order Submitted!');
            this.cart.length=0;
            this.order = Object.assign({}, this.orderDefault);
            this.showProduct=true;
          },
          resetFilters(){
            this.filters.inStockOnly=false;
            this.filters.sortAlpha='az';
          }
        },
        computed:{
          cartItemCount(){ return this.cart.length || ''; },
          cartDetails(){
            return this.activities
              .map(p=>({id:p.id,title:p.title,price:p.price,image:p.image,location:p.Location,qty:this.cartCount(p.id)}))
              .filter(i=>i.qty>0);
          },
          cartTotal(){
            return this.cartDetails.reduce((s,i)=>s+i.price*i.qty,0).toFixed(2);
          },
          sortedByTitle(){
            const copy=this.activities.slice();
            copy.sort((a,b)=>{
              const cmp=a.title.localeCompare(b.title);
              return this.filters.sortAlpha==='az'?cmp:-cmp;
            });
            return copy;
          },
          visibleCount(){
            return this.activities.filter(p=>{
              const left=p.availableInventory-this.cartCount(p.id);
              return !this.filters.inStockOnly || left>0;
            }).length;
          }
        }
      });
    </script>
  </body>
</html>
